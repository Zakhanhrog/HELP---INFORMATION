<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduZakhanh - Trợ giúp & Thông tin</title>
    <!-- Import Google Font -->
    <style>
        /* Reset and Box Sizing */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth; /* Smooth scrolling for anchor links */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            line-height: 1.7; /* Slightly increased line height for readability */
            color: #495057; /* Softer black for body text */
            background-color: #f8f9fa; /* Lighter, slightly warmer background */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 16px; /* Base font size */
        }

        .page-wrapper {
            display: flex;
            flex-grow: 1;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 260px; /* Slightly wider sidebar */
            background-color: #ffffff;
            border-right: 1px solid #dee2e6; /* Softer border color */
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 30px 20px;
            overflow-y: auto;
            z-index: 100; /* Ensure sidebar is on top */
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05); /* Subtle shadow for depth */
            transition: width 0.3s ease; /* Smooth transition for potential future collapse */
        }

        .sidebar h3 {
            font-size: 1.3em;
            font-weight: 600; /* Bolder heading */
            color: #0056b3; /* Primary blue */
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e9ecef; /* Lighter border */
            text-align: center;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 5px; /* Slightly reduced margin */
        }

        .sidebar a {
            text-decoration: none;
            color: #343a40; /* Darker grey for links */
            display: block;
            padding: 10px 15px; /* Increased padding */
            border-radius: 6px; /* More rounded corners */
            transition: all 0.3s ease; /* Smooth transition for all properties */
            font-size: 0.95em;
            position: relative; /* For potential pseudo-elements */
            font-weight: 500; /* Slightly bolder */
        }

        .sidebar a:hover,
        .sidebar a:focus,
        .sidebar a.active { /* Style for active link (requires JS or server-side logic to add 'active' class) */
            background-color: #e7f1ff; /* Lighter blue background */
            color: #0056b3; /* Primary blue text */
            transform: translateX(5px); /* Subtle shift effect */
        }

        /* Style for nested links */
        .sidebar ul ul a {
            padding-left: 35px; /* Indent nested links */
            font-size: 0.9em; /* Smaller font size for nested */
            color: #6c757d; /* Lighter color for nested */
            font-weight: 400;
        }
        .sidebar ul ul a:hover,
        .sidebar ul ul a:focus,
        .sidebar ul ul a.active {
            background-color: #e7f1ff; /* Same hover background */
            color: #004a99; /* Slightly darker blue on hover */
            transform: translateX(3px); /* Less shift for nested */
        }


        /* Content Area Styling */
        .content-area {
            flex-grow: 1;
            margin-left: 260px; /* Match sidebar width */
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease; /* Smooth transition if sidebar width changes */
        }

        .main-content {
            flex-grow: 1;
            padding: 40px 50px; /* Increased padding */
            background-color: #ffffff;
            border-radius: 8px; /* Rounded corners for content */
            margin: 20px; /* Add margin around the content */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* More prominent shadow */
        }

        /* Heading Styles */
        .main-content h1 {
            font-size: 2.4em; /* Larger H1 */
            font-weight: 700;
            color: #2c3e50; /* Dark slate color */
            text-align: center;
            margin-bottom: 50px; /* More space below H1 */
            position: relative;
            padding-bottom: 15px;
        }
        /* Optional: Add an underline effect to H1 */
        .main-content h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: #0056b3; /* Primary blue underline */
            border-radius: 2px;
        }

        .main-content h2 {
            font-size: 1.8em; /* Larger H2 */
            font-weight: 600;
            color: #0056b3; /* Primary blue for H2 */
            margin-top: 45px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #eaf2f8; /* Lighter, thicker border */
            position: relative; /* For potential icon or effect */
        }
        /* Style the first H2 differently (no top margin) */
        .main-content h2:first-of-type {
            margin-top: 0;
        }

        .main-content h3 {
            font-size: 1.4em; /* Larger H3 */
            font-weight: 600;
            color: #1a7fa8; /* Teal-ish blue for H3 */
            margin-top: 30px;
            margin-bottom: 15px;
        }

        /* Text and List Styles */
        .main-content p {
            margin-bottom: 18px;
            color: #495057; /* Consistent soft black */
            line-height: 1.8; /* Even more line height for paragraphs */
        }

        .main-content ul {
            margin-left: 30px; /* Standard indentation */
            margin-bottom: 18px;
            list-style-type: disc; /* Default bullet points */
        }
        .main-content ul li {
            margin-bottom: 10px;
            padding-left: 5px; /* Space between bullet and text */
        }

        .main-content hr {
            display: none; /* Keep HR hidden, use heading borders instead */
        }

        /* Link Styles in Content */
        .main-content a {
            color: #0069d9; /* Slightly brighter blue for links */
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
            background-image: linear-gradient(to right, #0069d9, #0069d9);
            background-size: 0% 2px; /* Start with underline hidden */
            background-repeat: no-repeat;
            background-position: left bottom;
        }

        .main-content a:hover,
        .main-content a:focus {
            color: #0056b3; /* Darker blue on hover */
            /* text-decoration: underline; */
            background-size: 100% 2px; /* Animate underline */
        }

        /* Emphasis Styles */
        .main-content b,
        .main-content strong {
            color: #212529; /* Darker color for emphasis */
            font-weight: 600; /* Ensure boldness */
        }

        /* Footer Styling */
        .site-footer {
            background-color: #2c3e50; /* Dark slate background */
            color: #adb5bd; /* Light grey text */
            padding: 50px 0 25px 0; /* Increased padding */
            border-top: 5px solid #0056b3; /* Thicker primary blue top border */
            font-size: 0.95em;
            margin-top: auto; /* Push footer to bottom */
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px; /* Increased gap */
        }

        .footer-section {
            flex: 1;
            min-width: 240px; /* Slightly larger min-width */
        }

        .footer-section h4 {
            font-size: 1.25em;
            font-weight: 600;
            color: #ffffff; /* White heading */
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 12px;
        }
        /* Underline effect for footer headings */
        .footer-section h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: #007bff; /* Brighter blue accent */
            border-radius: 1px;
        }

        .footer-section p {
            margin-bottom: 12px;
            line-height: 1.8;
            color: #ced4da; /* Lighter grey for text */
        }

        .footer-section ul {
            list-style: none;
            padding-left: 0;
            margin-left: 0;
        }

        .footer-section li {
            margin-bottom: 12px;
        }

        .footer-section a {
            color: #ced4da; /* Lighter grey for links */
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: normal; /* Normal weight for footer links */
            position: relative; /* For potential effects */
            padding-bottom: 2px; /* Space for potential underline */
        }

        .footer-section a:hover,
        .footer-section a:focus {
            color: #ffffff; /* White on hover */
            text-decoration: none; /* Remove default underline */
            padding-left: 5px; /* Subtle move effect */
        }
        /* Optional: Add a subtle bottom border on hover */
        .footer-section a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            display: block;
            margin-top: 2px;
            right: 0;
            background: #ffffff;
            transition: width .2s ease;
            -webkit-transition: width .2s ease;
        }
        .footer-section a:hover::after {
            width: 100%;
            left: 0;
            background: #ffffff;
        }


        .footer-section .contact-admin strong {
            color: #ffffff; /* White for admin name */
            font-weight: 600;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid #495057; /* Slightly darker border */
            font-size: 0.9em;
            color: #adb5bd; /* Light grey */
        }
        .footer-bottom p {
            color: #adb5bd; /* Ensure paragraph inherits color */
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-content {
                padding: 30px 35px;
            }
            .main-content h1 {
                font-size: 2.1em;
            }
            .main-content h2 {
                font-size: 1.6em;
            }
            .main-content h3 {
                font-size: 1.3em;
            }
        }

        @media (max-width: 768px) {
            .page-wrapper {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: static; /* Change position */
                border-right: none;
                border-bottom: 1px solid #dee2e6;
                z-index: auto;
                box-shadow: none; /* Remove shadow on mobile */
                padding: 20px; /* Adjust padding */
            }
            .sidebar h3 {
                text-align: left; /* Align left on mobile */
                margin-bottom: 15px;
            }
            .content-area {
                margin-left: 0; /* Remove margin */
            }
            .main-content {
                padding: 25px 20px; /* Adjust padding */
                margin: 15px; /* Adjust margin */
                border-radius: 6px; /* Slightly less rounded on mobile */
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); /* Lighter shadow */
            }
            .main-content h1 {
                font-size: 1.9em;
                margin-bottom: 30px;
                padding-bottom: 10px;
            }
            .main-content h1::after { /* Adjust underline */
                width: 60px;
                height: 3px;
            }
            .main-content h2 {
                font-size: 1.5em;
                margin-top: 30px;
            }
            .main-content h3 {
                font-size: 1.25em;
                margin-top: 25px;
            }

            /* Footer Responsive Adjustments */
            .footer-container {
                flex-direction: column; /* Stack sections */
                padding: 0 25px;
                gap: 30px;
            }
            .footer-section {
                min-width: auto;
                margin-bottom: 15px;
            }
            .footer-section h4 {
                margin-bottom: 15px;
                font-size: 1.2em;
            }
            .footer-bottom {
                margin-top: 25px;
                padding-top: 20px;
                font-size: 0.85em; /* Smaller text in footer bottom */
            }
        }

        /* Additional subtle animation for content loading (optional) */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-content section { /* Assuming content is wrapped in sections, or apply to h2/p */
            animation: fadeIn 0.5s ease-out forwards;
            /* Stagger animation if needed with animation-delay */
        }

    </style>
</head>
<body>
<div class="page-wrapper">
    <nav class="sidebar">
        <h3>Mục Lục</h3>
        <ul>
            <li><a href="#welcome">Chào mừng</a></li>
            <li><a href="#navigation">Điều hướng chung</a></li>
            <li><a href="#roles">Vai trò & Quyền hạn</a></li>
            <li><a href="#features">Tính năng cốt lõi</a>
                <ul>
                    <!-- Removed inline styles, rely on CSS rules -->
                    <li><a href="#admin-view">- Quản trị viên</a></li>
                    <li><a href="#teacher-view">- Giáo viên</a></li>
                    <li><a href="#student-view">- Học viên</a></li>
                </ul>
            </li>
            <li><a href="#common-actions">Hành động phổ biến</a></li>
            <li><a href="#other-features">Tính năng khác</a></li>
            <li><a href="#troubleshooting">Gỡ rối & Liên hệ</a></li>
        </ul>
    </nav>

    <div class="content-area">
        <main class="main-content">

            <!-- Added sections for potential animation hook -->
            <section id="welcome">
                <h1>EduZakhanh - Trợ giúp & Thông tin</h1>
                <h2>Chào mừng</h2>
                <p>
                    Chào mừng bạn đến với Hệ thống Quản lý Giáo dục EduZakhanh! Hướng dẫn này cung cấp thông tin về cách điều hướng và sử dụng các tính năng của ứng dụng một cách hiệu quả nhất.
                </p>
            </section>

            <section id="navigation">
                <h2>Điều hướng chung</h2>
                <ul>
                    <li>Sử dụng các <b>tab điều hướng chính</b> (ví dụ: <b>Lịch trình</b>, <b>Lớp học</b>, <b>Học viên</b>...) để truy cập các phân hệ quản lý khác nhau của hệ thống.</li>
                    <li>Dữ liệu thường được trình bày dưới dạng <b>bảng biểu</b>. Bạn có thể nhấp vào <b>tiêu đề cột</b> để sắp xếp dữ liệu tăng dần hoặc giảm dần.</li>
                    <li>Các nút chức năng như <b style="color:#28a745;">Thêm</b>, <b style="color:#ffc107; text-shadow: 1px 1px 1px #aaa;">Sửa</b>, và <b style="color:#dc3545;">Xóa</b> thường được đặt gần bảng dữ liệu tương ứng.</li>
                    <li>Sử dụng thanh <b>menu chính</b> (<b>Chính</b>, <b>Xuất file</b>, <b>Xem</b>, <b>Trợ giúp</b>) cho các thao tác toàn cục như đăng xuất, xuất báo cáo, thay đổi giao diện, và truy cập trang trợ giúp này.</li>
                </ul>
            </section>

            <section id="roles">
                <h2>Vai trò và Quyền hạn</h2>
                <p>Chức năng và dữ liệu bạn có thể thấy và tương tác phụ thuộc vào vai trò tài khoản của bạn:</p>
                <ul>
                    <li><b>Quản trị viên (Administrator):</b> Có toàn quyền truy cập mọi tính năng, bao gồm quản lý tài khoản người dùng, cấu hình hệ thống và xem nhật ký hoạt động chi tiết.</li>
                    <li><b>Giáo viên (Teacher):</b> Có thể xem lịch dạy cá nhân, quản lý điểm danh và thông tin học viên trong các lớp được phân công, xem thông tin khóa học.</li>
                    <li><b>Học viên (Student):</b> Có thể xem lịch học cá nhân, thông tin các lớp đã đăng ký, kết quả học tập (nếu có) và thông tin khóa học chung.</li>
                </ul>
            </section>

            <section id="features">
                <h2>Tính năng cốt lõi theo từng vai trò</h2>

                <h3 id="admin-view">Giao diện Quản trị viên</h3>
                <ul>
                    <li><b>Lịch trình (Schedule):</b> Xem, tạo mới, chỉnh sửa và xóa lịch học. Sử dụng bộ lọc ngày và nút 'Tải lịch trình' để xem các khoảng thời gian mong muốn. Hệ thống sẽ cảnh báo các xung đột tiềm ẩn (trùng thời gian/giáo viên/phòng học).</li>
                    <li><b>Lớp học (Classes):</b> Quản lý thông tin lớp học, phân công khóa học và giáo viên phụ trách. Thêm hoặc xóa học viên khỏi danh sách lớp (ghi danh). Thiết lập sĩ số tối đa cho từng lớp.</li>
                    <li><b>Học viên (Students):</b> Quản lý hồ sơ chi tiết của học viên (thêm, sửa, xóa). Đảm bảo thông tin liên hệ, đặc biệt là số điện thoại, là chính xác để phục vụ việc đăng ký tài khoản.</li>
                    <li><b>Giáo viên (Teachers):</b> Quản lý hồ sơ giáo viên. Mã ID Giáo viên (tự động tạo hoặc nhập khi tạo mới) là cần thiết cho việc đăng ký tài khoản Giáo viên.</li>
                    <li><b>Khóa học (Courses):</b> Định nghĩa và quản lý danh mục các khóa học mà trung tâm cung cấp.</li>
                    <li><b>Phòng học (Rooms):</b> Quản lý danh sách phòng học (vật lý hoặc trực tuyến), bao gồm thông tin về sức chứa và loại phòng.</li>
                    <li><b>Tài khoản (Accounts):</b> Xem danh sách tài khoản người dùng (Giáo viên, Học viên). Có quyền đặt lại mật khẩu khi cần thiết.</li>
                    <li><b>Nhật ký (Logs):</b> Theo dõi lịch sử các hành động quan trọng được thực hiện trong hệ thống (cập nhật tự động theo thời gian thực).</li>
                    <li><b>Trợ giúp (Help):</b> Truy cập nhanh vào trang hướng dẫn sử dụng này.</li>
                </ul>

                <h3 id="teacher-view">Giao diện Giáo viên</h3>
                <ul>
                    <li><b>Lịch trình của tôi (My Schedule):</b> Hiển thị lịch giảng dạy cá nhân của bạn trong khoảng thời gian được chọn.</li>
                    <li><b>Lớp học của tôi (My Classes):</b> Liệt kê các lớp bạn đang phụ trách, cho phép xem danh sách học viên đã ghi danh và các thông tin liên quan.</li>
                    <li><b>Học viên của tôi (My Students):</b> Cung cấp cái nhìn tổng quan về danh sách học viên trong các lớp bạn dạy.</li>
                    <li><b>Khóa học (Courses):</b> Cho phép xem thông tin chi tiết về các khóa học hiện có trong hệ thống.</li>
                    <li><b>Trợ giúp (Help):</b> Truy cập nhanh vào trang hướng dẫn sử dụng này.</li>
                </ul>

                <h3 id="student-view">Giao diện Học viên</h3>
                <ul>
                    <li><b>Lịch học của tôi (My Schedule):</b> Hiển thị lịch học cá nhân của bạn theo tuần hoặc tháng.</li>
                    <li><b>Lớp học của tôi (My Classes):</b> Liệt kê các lớp học mà bạn đã đăng ký và đang theo học.</li>
                    <li><b>Khóa học (Courses):</b> Cho phép xem thông tin chi tiết về các khóa học hiện có để tham khảo.</li>
                    <li><b>Trợ giúp (Help):</b> Truy cập nhanh vào trang hướng dẫn sử dụng này.</li>
                </ul>
            </section>

            <section id="common-actions">
                <h2>Hành động phổ biến</h2>
                <ul>
                    <li><b>Thêm dữ liệu:</b> Nhấp vào nút 'Thêm' (hoặc biểu tượng tương tự) trong phần quản lý tương ứng. Một cửa sổ (dialog) sẽ hiện ra yêu cầu nhập thông tin cần thiết.</li>
                    <li><b>Sửa dữ liệu:</b> Chọn một dòng trong bảng dữ liệu bạn muốn chỉnh sửa, sau đó nhấp vào nút 'Sửa'. Cửa sổ chỉnh sửa sẽ hiện ra với thông tin hiện tại đã được điền sẵn.</li>
                    <li><b>Xóa dữ liệu:</b> Chọn một dòng trong bảng và nhấp nút 'Xóa'. Hệ thống thường sẽ yêu cầu xác nhận trước khi xóa vĩnh viễn. Lưu ý: Một số mục không thể xóa nếu đang có liên kết dữ liệu (ví dụ: không thể xóa giáo viên đang được phân công dạy).</li>
                    <li><b>Lọc/Tải dữ liệu:</b> Sử dụng các bộ lọc (như chọn ngày, chọn trạng thái) và nhấp vào các nút như 'Tải lịch trình', 'Lọc', 'Tìm kiếm' để giới hạn phạm vi dữ liệu hiển thị.</li>
                </ul>
            </section>

            <section id="other-features">
                <h2>Tính năng khác</h2>
                <ul>
                    <li><b>Xuất dữ liệu:</b> Quản trị viên và Giáo viên có thể xuất các bảng dữ liệu quan trọng (lịch trình, danh sách lớp, học viên...) sang định dạng Excel thông qua menu <b>Xuất file > Xuất ra Excel...</b>.</li>
                    <li><b>Thay đổi giao diện:</b> Tùy chỉnh màu sắc và chủ đề giao diện của ứng dụng thông qua menu <b>Xem > Giao diện</b> để phù hợp với sở thích cá nhân.</li>
                    <li><b>Đăng xuất:</b> Luôn sử dụng tùy chọn <b>Chính > Đăng xuất</b> để kết thúc phiên làm việc một cách an toàn, bảo vệ tài khoản của bạn.</li>
                    <li><b>Thoát ứng dụng:</b> Sử dụng <b>Chính > Thoát</b> hoặc nút đóng cửa sổ [X] để đóng hoàn toàn ứng dụng. Sẽ có hộp thoại xác nhận để tránh thoát nhầm.</li>
                </ul>
            </section>

            <section id="troubleshooting">
                <h2>Gỡ rối & Liên hệ</h2>
                <p>
                    Nếu bạn gặp phải vấn đề kỹ thuật hoặc có câu hỏi chưa được giải đáp trong tài liệu này:
                </p>
                <ul>
                    <li>Hãy đảm bảo rằng bạn đã nhập dữ liệu một cách chính xác, đặc biệt là các trường thông tin bắt buộc (thường được đánh dấu *).</li>
                    <li>Kiểm tra thanh trạng thái ở phía dưới cùng của cửa sổ ứng dụng để xem có thông báo lỗi hoặc cảnh báo nào không.</li>
                    <li>Khởi động lại ứng dụng có thể giải quyết các sự cố tạm thời.</li>
                    <li>Liên hệ với quản trị viên hệ thống được chỉ định: <strong>zakhanh</strong></li>
                    <li>Tham khảo <a href="https://github.com/Zakhanhrog/EduManagerZK/issues" target="_blank" rel="noopener noreferrer">Kênh báo lỗi trên GitHub</a> để báo cáo lỗi hoặc xem các vấn đề đã biết.</li>
                </ul>
            </section>

        </main>

        <footer class="site-footer">
            <div class="footer-container">
                <div class="footer-section about">
                    <h4>Về EduZakhanh</h4>
                    <p>EduZakhanh là một giải pháp quản lý giáo dục toàn diện, được phát triển nhằm mục đích tối ưu hóa quy trình hành chính, nâng cao hiệu quả giảng dạy và học tập, đồng thời cải thiện sự tương tác trong cộng đồng giáo dục.</p>
                </div>
                <div class="footer-section quick-links">
                    <h4>Điều hướng nhanh</h4>
                    <ul>
                        <li><a href="#welcome">Chào mừng</a></li>
                        <li><a href="#features">Tổng quan Tính năng</a></li>
                        <li><a href="#roles">Vai trò Người dùng</a></li>
                        <li><a href="#common-actions">Hành động Phổ biến</a></li>
                        <li><a href="#troubleshooting">Hỗ trợ & Liên hệ</a></li>
                    </ul>
                </div>
                <div class="footer-section contact">
                    <h4>Thông tin liên hệ</h4>
                    <p class="contact-admin">Quản trị viên hệ thống: <strong>zakhanh</strong></p>
                    <p>Email hỗ trợ: <a href="mailto:18khanh.2003@gmail.com">18khanh.2003@gmail.com</a></p>
                    <p>Địa chỉ: SN26, Khu phố Thịnh Cầu, Phường Phương Mao, TX. Quế Võ, T. Bắc Ninh</p>
                    <p>Xem mã nguồn & báo lỗi tại: <a href="https://github.com/Zakhanhrog/EduManagerZK" target="_blank" rel="noopener noreferrer">GitHub Repository</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2024 EduZakhanh. Thiết kế và phát triển bởi Zakhanh. Bảo lưu mọi quyền.</p>
            </div>
        </footer>
    </div>
</div>
<!-- Optional: Add JS for active sidebar link highlighting on scroll -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('main section[id]');
        const navLinks = document.querySelectorAll('.sidebar a[href^="#"]');

        const activateLink = (id) => {
            navLinks.forEach(link => {
                link.classList.remove('active');
                // Check both direct href and href within nested lists
                if (link.getAttribute('href') === `#${id}` || link.closest('li')?.querySelector(`a[href="#${id}"]`)) {
                    // Check if it's a parent link of a nested structure
                    const parentLi = link.closest('ul')?.closest('li');
                    if(parentLi && parentLi.querySelector('ul a') === link) {
                        // It's a nested link, activate it
                        link.classList.add('active');
                        // Also activate its parent if needed
                        const parentLink = parentLi.querySelector('a[href^="#"]');
                        if(parentLink) parentLink.classList.add('active');
                    } else {
                        // It's a top-level link or the main link in a nested group
                        link.classList.add('active');
                    }
                }
            });
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.intersectionRatio >= 0.5) { // Activate when 50% visible
                    activateLink(entry.target.id);
                }
            });
        }, {
            rootMargin: '0px 0px -40% 0px', // Trigger activation higher up the screen
            threshold: 0.5 // Trigger when 50% of the element is visible
        });

        sections.forEach(section => {
            observer.observe(section);
        });

        // Initial activation on load for the top section or hash
        if (window.location.hash) {
            activateLink(window.location.hash.substring(1));
        } else if (sections.length > 0){
            // Activate the first section if no hash
            activateLink(sections[0].id);
        }
    });
</script>
</body>
</html>